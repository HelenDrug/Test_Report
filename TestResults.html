<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link rel="stylesheet" href="TestResults.css" />
    <script type="text/javascript" src="data.json"></script>
    <title>Test Report</title>
    <script
      crossorigin
      src="https://unpkg.com/react@16/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script
      src="https://kit.fontawesome.com/88335fd46d.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const truncateString = (str, number) => {
        if (str.length <= 60) {
          return str;
        }
        return `${str.slice(0, number)} ... ${str.slice(-number, str.length)}`;
      };

      const durationToTimeStr = (action) => {
        if (action.hasOwnProperty("duration")) {
          const date = new Date(action.duration);
          const pad = (v, n = 2) => v.toString().padStart(n, "0");
          return `${pad(date.getUTCHours())}:${pad(date.getUTCMinutes())}:${pad(
            date.getUTCSeconds()
          )}:${pad(date.getUTCMilliseconds())}`;
        }
      };

      const App = () => {
        const [action, setAction] = React.useState(testData[0]);
        const [filters, setFilters] = React.useState([
          { label: "Ignored", value: "ignored", isChecked: false },
          { label: "Passed", value: "passed", isChecked: false },
          { label: "Failed", value: "failed", isChecked: true },
        ]);

        const prefix = testData[0].utrPrefix + " ";

        const handleActionChange = (childAction) => {
          setAction({ ...childAction });
        };

        const handleFilterChange = (newFilters) => {
          setFilters(newFilters);
        };
        return (
          <div className="App">
            <header
              className={`test-report-header ${
                !status ? `bgFail` : `bgSuccess`
              }`}
            >
              <h1>Test Session Report</h1>
            </header>
            <TestFilter filters={filters} onFilterChange={handleFilterChange} />
            <SplitPane>
              <SplitPane.Left>
                <div className="content-header">
                  <span>Action</span>
                  <span>Duration</span>
                  <span>Artifacts</span>
                </div>
                <div>
                  <ActionsTree
                    action={testData}
                    handleActionChange={handleActionChange}
                    filter={filters}
                  />
                </div>
              </SplitPane.Left>
              <SplitPane.Right>
                <DisplayActionsTree action={action} prefix={prefix} />
              </SplitPane.Right>
            </SplitPane>
          </div>
        );
      };

      const TestFilter = ({ filters, onFilterChange }) => {
        const handleFilterChange = ({ name, label, checked }) => {
          const temp = [...filters];
          temp.forEach((filter) => {
            if (filter.value === name) {
              filter.isChecked = checked;
            }
          });
          onFilterChange(temp);
        };

        return (
          <div className="navigation">
            <form className="test-filter">
              <fieldset>
                <legend>Test Status filter</legend>
                {filters.map((filter) => (
                  <Checkbox
                    key={filter.value}
                    label={filter.label}
                    name={filter.value}
                    checked={filter.isChecked}
                    onChange={handleFilterChange}
                    className="filter-item"
                  />
                ))}
              </fieldset>
            </form>
          </div>
        );
      };

      const Checkbox = ({ label, name, checked, onChange, className }) => {
        const handleOnChange = (e) => {
          onChange({ checked: e.target.checked, name, label });
        };

        return (
          <span className={className}>
            <label>
              {label}
              <input
                type="checkbox"
                name={name}
                value={name}
                checked={checked}
                onChange={handleOnChange}
              />
            </label>
          </span>
        );
      };

      const ActionsTree = ({ handleActionChange, action, filter }) => {
        const [nodes, setNodes] = React.useState(action);

        const getChildNodes = (node) => {
          return node.children.map((node) => nodes[node.index]);
        };

        const hasChildren = (node) => {
          return node.children.length !== 0;
        };

        const onToggle = (node) => {
          const newNodes = nodes.map((n) => {
            if (n.index === node.index) {
              return { ...n, isOpen: !node.isOpen };
            }
            return n;
          });

          setNodes(newNodes);
        };
        const firstLevelNode = nodes[0];

        return (
          <div>
            <Node
              key={firstLevelNode.index}
              node={firstLevelNode}
              getChildNodes={getChildNodes}
              onToggle={onToggle}
              hasChildren={hasChildren}
              handleActionChange={handleActionChange}
              filter={filter}
            />
          </div>
        );
      };

      const Node = ({
        node,
        getChildNodes,
        onToggle,
        hasChildren,
        handleActionChange,
        filter,
      }) => {
        const getCarretStyle = (node) => {
          if (!hasChildren(node)) {
            return <></>;
          }

          return <i className={`fas fa-${node.isOpen ? "minus" : "plus"}`} />;
        };

        const showArtifacts = () => {
          if (node.artifacts.length != 0) {
            return (
              <span>
                {node.artifacts.length}
                <i className="fas fa-paperclip"></i>
              </span>
            );
          }
        };

        const showNode = () => {
          if (node.type === null) {
            return;
          }
          switch (node.type) {
            case "TestSession":
              return <TestSessionNode node={node} />;
            case "TestPlan":
              return <TestPlanNode node={node} />;
            case "TestSuite":
              return <TestSuiteNode node={node} />;
            case "TestStatus":
              return <TestStatusNode node={node} />;
            case "TestGroup":
              return <TestGroupNode node={node} />;
            case "Assert":
              return <AssertNode node={node} />;
            case "ProcessInfo":
              return <ProcessInfoNode node={node} />;
            case "Info":
              return <InfoNode node={node} />;
            case "LogEntry":
              return <LogEntryNode node={node} />;
            case "MemoryLeaks":
              return <MemoryLeaksNode node={node} />;
            default:
              return <DefaultNode node={node} />;
          }
        };

        const shouldDisplayFailed = (filter) => {
          for (let i = 0; i < filter.length; ++i) {
            if (filter[i].value === "failed" && filter[i].isChecked === true) {
              return true;
            }
          }
          return false;
        };

        const shouldDisplayPassed = (filter) => {
          for (let i = 0; i < filter.length; ++i) {
            if (filter[i].value === "passed" && filter[i].isChecked === true) {
              return true;
            }
          }
          return false;
        };

        const shouldDisplayIgnored = (filter) => {
          for (let i = 0; i < filter.length; ++i) {
            if (filter[i].value === "ignored" && filter[i].isChecked === true) {
              return true;
            }
          }
          return false;
        };

        const isFailedTestStatus = (testStatusNode) => {
          return (
            testStatusNode.state === 0 ||
            testStatusNode.state === 5 ||
            testStatusNode.state === 6
          );
        };

        const isPassedTestStatus = (testStatusNode) => {
          return testStatusNode.state === 4;
        };

        const isIgnoredTestStatus = (testStatusNode) => {
          return (
            testStatusNode.state === 1 ||
            testStatusNode.state === 2 ||
            testStatusNode.state === 3 ||
            testStatusNode.state === 7
          );
        };

        const isFailedTestGroup = (testNode) => {
          return testNode.errors.length !== 0 ? true : false;
        };

        const isPassedTestGroup = (testNode) => {
          return testNode.errors.length == 0 ? true : false;
        };

        const isFailedTestSuite = (testNode) => {
          return testNode.errors.length !== 0 ? true : false;
        };

        const isPassedTestSuite = (testNode) => {
          return testNode.errors.length == 0 ? true : false;
        };

        const displayTestStatusNode = (child, filter) => {
          const shouldBeDisplayed =
            (shouldDisplayFailed(filter) && isFailedTestStatus(child)) ||
            (shouldDisplayPassed(filter) && isPassedTestStatus(child)) ||
            (shouldDisplayIgnored(filter) && isIgnoredTestStatus(child));

          if (shouldBeDisplayed) {
            return (
              <Node
                node={child}
                key={child.index}
                getChildNodes={getChildNodes}
                onToggle={onToggle}
                hasChildren={hasChildren}
                handleActionChange={handleActionChange}
                filter={filter}
              />
            );
          } else {
            return null;
          }
        };

        const displayTestGroupNode = (child, filter) => {
          const shouldBeDisplayed =
            (shouldDisplayFailed(filter) && isFailedTestGroup(child)) ||
            (shouldDisplayPassed(filter) && isPassedTestGroup(child));

          if (shouldBeDisplayed) {
            return (
              <Node
                node={child}
                key={child.index}
                getChildNodes={getChildNodes}
                onToggle={onToggle}
                hasChildren={hasChildren}
                handleActionChange={handleActionChange}
                filter={filter}
              />
            );
          } else {
            return null;
          }
        };

        const displayTestSuiteNode = (child, filter) => {
          const shouldBeDisplayed =
            (shouldDisplayFailed(filter) && isFailedTestSuite(child)) ||
            (shouldDisplayPassed(filter) && isPassedTestSuite(child));
          if (shouldBeDisplayed) {
            return (
              <Node
                node={child}
                key={child.index}
                getChildNodes={getChildNodes}
                onToggle={onToggle}
                hasChildren={hasChildren}
                handleActionChange={handleActionChange}
                filter={filter}
              />
            );
          } else {
            return null;
          }
        };

        const displayInfoNode = (child, filter) => {
          for (let i = 0; i < filter.length; ++i) {
            if (filter[i].value === "failed" && filter[i].isChecked === true) {
              return null;
            } else if (
              filter[i].value === "passed" &&
              filter[i].isChecked === true
            ) {
              return (
                <Node
                  node={child}
                  key={child.index}
                  getChildNodes={getChildNodes}
                  onToggle={onToggle}
                  hasChildren={hasChildren}
                  handleActionChange={handleActionChange}
                  filter={filter}
                />
              );
            }
          }
        };

        return (
          <>
            <div className="node-container">
              <div
                className="node-title"
                role="button"
                onClick={() => handleActionChange(node)}
              >
                <span className="toggle" onClick={() => onToggle(node)}>
                  {getCarretStyle(node)}
                </span>
                {showNode()}
              </div>
              <div className="duration">{durationToTimeStr(node)}</div>
              <div className="artifacts">{showArtifacts()}</div>
            </div>

            <div className="node-child">
              {node.isOpen &&
                getChildNodes(node).map((childNode) => {
                  if (childNode.type === "ArtifactPublish") {
                    return null;
                  }
                  if (childNode.type === "Info") {
                    return null;
                  }
                  if (childNode.type === "TestStatus") {
                    return displayTestStatusNode(childNode, filter);
                  }
                  if (childNode.type === "TestGroup") {
                    return displayTestGroupNode(childNode, filter);
                  }
                  if (childNode.type === "TestSuite") {
                    return displayTestSuiteNode(childNode, filter);
                  } else {
                    return (
                      <Node
                        node={childNode}
                        key={childNode.index}
                        getChildNodes={getChildNodes}
                        onToggle={onToggle}
                        hasChildren={hasChildren}
                        handleActionChange={handleActionChange}
                        filter={filter}
                      />
                    );
                  }
                })}
            </div>
          </>
        );
      };

      const DisplayActionsTree = ({ action, prefix }) => {
        const getComponentToDisplay = () => {
          if (action.type === null) {
            return;
          }

          switch (action.type) {
            case "ProcessInfo":
              return <ProcessInfo action={action} />;
            case "TestSession":
              return <TestSession action={action} prefix={prefix} />;
            case "TestSuite":
              return <TestSuite action={action} prefix={prefix} />;
            case "TestPlan":
              return <TestPlan action={action} />;
            case "TestGroup":
              return <TestGroup action={action} />;
            case "TestStatus":
              return <TestStatus action={action} prefix={prefix} />;
            case "Info":
              return <Info action={action} />;
            case "LogEntry":
              return <LogEntry action={action} />;
            case "MemoryLeaks":
              return <MemoryLeaks action={action} />;
            default:
              return <Default action={action} />;
          }
        };

        return <div>{getComponentToDisplay()}</div>;
      };

      //components to display on ActionsTree (left part)
      const TestSessionNode = ({ node }) => {
        return (
          <>
            {!node.summary.success ? <IconFail /> : <IconSuccess />}
            <span>{node.type}</span>
            {!node.summary.success ? (
              <StatusFail status={"FAILED"} />
            ) : (
              <StatusSuccess status={"SUCCESS"} />
            )}
          </>
        );
      };

      const TestPlanNode = ({ node }) => {
        return (
          <>
            <span>
              Ready to run <strong>{node.tests.length}</strong> test(s).
            </span>
          </>
        );
      };

      const TestSuiteNode = ({ node }) => {
        return (
          <>
            {node.errors.length !== 0 ? <IconFail /> : <IconSuccess />}
            <span>
              Run <strong>{node.name}</strong> tests for{" "}
              <strong>{node.scope}</strong>
            </span>
          </>
        );
      };

      const TestStatusNode = ({ node }) => {
        const setIcon = () => {
          switch (node.state) {
            case 0:
              return null;
            case 1:
            case 2:
            case 3:
            case 7:
              return <IconIgnored />;
            case 5:
            case 6:
              return <IconFail />;
            case 4:
              return <IconSuccess />;
            default:
              return null;
          }
        };

        const setStatus = () => {
          switch (node.state) {
            case 0:
              return <StatusInconclusive status={"Inconclusive"} />;
            case 1:
            case 2:
            case 3:
            case 7:
              return <StatusIgnored status={"Ignored"} />;
            case 4:
              return <StatusSuccess status={"Success"} />;
            case 5:
            case 6:
              return <StatusFail status={"Failed"} />;
            default:
              return null;
          }
        };

        return (
          <>
            {setIcon()}
            <span>{node.name}</span>
          </>
        );
      };

      const TestGroupNode = ({ node }) => {
        const shortenPathName = (path) => {
          const regex = /[\/\\]/;
          const tokens = path.split(regex);
          let fileName = tokens[tokens.length - 1];
          return fileName;
        };

        return (
          <>
            {node.errors.length !== 0 ? <IconFail /> : <IconSuccess />}
            <span>{shortenPathName(node.name)}</span>
          </>
        );
      };

      const AssertNode = ({ node }) => {
        return (
          <>
            <IconFail />
            <span>{node.name}</span>
          </>
        );
      };

      const ProcessInfoNode = ({ node }) => {
        return (
          <>
            <span>Start process:</span>
            {node.exitCode !== 0 ? (
              <span className="statusFail">
                {truncateString(node.path, 30)}
              </span>
            ) : (
              <span>{truncateString(node.path, 30)}</span>
            )}
          </>
        );
      };

      const InfoNode = ({ node }) => {
        return (
          <>
            <span>{truncateString(node.message, 30)}</span>
          </>
        );
      };

      const LogEntryNode = ({ node }) => {
        const setSeverity = () => {
          switch (node.severity) {
            case "Error":
              return <IconFail />;
            case "Warning":
              return <IconWarn />;
            case "Assert":
              return <IconFail />;
            default:
              return null;
          }
        };

        return (
          <>
            {setSeverity()}
            <span>{node.message}</span>
          </>
        );
      };

      const MemoryLeaksNode = ({ node }) => {
        return (
          <>
            <span>Memory leaks</span>
          </>
        );
      };

      const DefaultNode = ({ node }) => {
        return (
          <>
            {node.errors.length !== 0 ? <IconFail /> : <IconSuccess />}
            {node.name != 0 ? (
              <span>
                {node.type}
                {node.name}
              </span>
            ) : (
              <span>{node.type}</span>
            )}
          </>
        );
      };

      //small components for NodeTree components composition

      const IconFail = () => {
        return (
          <>
            <span>
              <i className="fas fa-ban iconFail"></i>
            </span>
          </>
        );
      };

      const IconSuccess = () => {
        return (
          <>
            <span>
              <i className="fas fa-check iconSuccess"></i>
            </span>
          </>
        );
      };

      const IconIgnored = () => {
        return (
          <>
            <span>
              <i className="fas fa-eye-slash iconIgnored"></i>
            </span>
          </>
        );
      };

      const IconWarn = () => {
        return (
          <>
            <span>
              <i className="fa fa-exclamation"></i>
            </span>
          </>
        );
      };

      const StatusFail = ({ status }) => {
        return (
          <>
            <span className="statusFail">{status}</span>
          </>
        );
      };

      const StatusSuccess = ({ status }) => {
        return (
          <>
            <span className="statusSuccess">{status}</span>
          </>
        );
      };

      const StatusIgnored = ({ status }) => {
        return (
          <>
            <span className="statusIgnored">{status}</span>
          </>
        );
      };

      const StatusInconclusive = ({ status }) => {
        return (
          <>
            <span className="statusInconclusive">{status}</span>
          </>
        );
      };

      //components to display on DisplayActionsTree (right part)
      const ProcessInfo = ({ action }) => {
        return (
          <div className="process-info-container">
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <Path action={action} />
            <Arguments action={action} />
            <Errors action={action} />
            <Artifacts action={action} />
            <ProcessId action={action} />
          </div>
        );
      };

      const TestSession = ({ action, prefix }) => {
        return (
          <div className="test-session-container">
            <Summary action={action} />
            <OverallResult action={action} />
            <Conclusion action={action} />
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <Command action={action} prefix={prefix} />
            <BuildUrl action={action} />
            <Artifacts action={action} />
            <Errors action={action} />
            <ProcessId action={action} />
          </div>
        );
      };

      const TestPlan = ({ action }) => {
        return (
          <div className="display-margin">
            <div className="blue bottom-space">
              Ready to run <strong>{action.tests.length}</strong> test(s):
            </div>
            {action.tests.map((item) => (
              <p className="selector" key={item}>
                {item}
              </p>
            ))}
          </div>
        );
      };

      const TestSuite = ({ action, prefix }) => {
        return (
          <div className="test-suite-container">
            <Summary action={action} />
            <OverallResult action={action} />
            <Conclusion action={action} />
            <Name action={action} />
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <Scope action={action} />
            <Platform action={action} />
            <Command action={action} prefix={prefix} />
            <Artifacts action={action} />
            <Errors action={action} />
          </div>
        );
      };

      const TestGroup = ({ action }) => {
        return (
          <div className="test-group-container">
            <Name action={action} />
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <Errors action={action} />
          </div>
        );
      };

      const TestStatus = ({ action, prefix }) => {
        return (
          <div className="test-status-container">
            <Name action={action} />
            <OverallResult action={action} />
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <Message action={action} />
            <StackTrace action={action} />
            <Errors action={action} />
            <Command action={action} prefix={prefix} />
            <ImageComparison action={action} />
          </div>
        );
      };

      const Info = ({ action }) => {
        return (
          <div>
            <Message action={action} />
          </div>
        );
      };

      const LogEntry = ({ action }) => {
        return (
          <div>
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <Severity action={action} />
            <Message action={action} />
            <StackTrace action={action} />
            <Line action={action} />
            <File action={action} />
            <Errors action={action} />
            <ProcessId action={action} />
          </div>
        );
      };

      const MemoryLeaks = ({ action }) => {
        return (
          <div>
            <Phase action={action} />
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            <MemoryLabels action={action} />
            <Errors action={action} />
            <Artifacts action={action} />
            <ProcessId action={action} />
          </div>
        );
      };

      const Default = ({ action }) => {
        return (
          <div>
            {action.hasOwnProperty("name") ? <Name action={action} /> : null}
            {action.hasOwnProperty("type") ? <Type action={action} /> : null}
            {action.hasOwnProperty("duration") ? (
              action.duration.length != 0 ? (
                <Duration action={action} />
              ) : null
            ) : null}
            {action.hasOwnProperty("artifacts") &&
            action.artifacts.length !== 0 ? (
              <Artifacts action={action} />
            ) : null}
            {action.hasOwnProperty("errors") && action.errors.length !== 0 ? (
              <Error action={action} />
            ) : null}
            {action.hasOwnProperty("message") ? (
              <Message action={action} />
            ) : null}
            <ProcessId action={action} />
          </div>
        );
      };

      //reusable components

      const ProcessId = ({ action }) => {
        return (
          <div className="display-margin">
            <p>
              <span className="blue">Process id:</span>{" "}
              <strong>{action.processId}</strong>
            </p>
          </div>
        );
      };

      const Name = ({ action }) => {
        return (
          <div className="name display-margin">
            <span className="blue">Name:</span>{" "}
            <strong className="selector">{action.name}</strong>
          </div>
        );
      };

      const Path = ({ action }) => {
        return (
          <div className="display-margin">
            <div className="blue">Path: </div>
            <CopyToClipboard content={action.path} />
            <span className="selector">{action.path}</span>
          </div>
        );
      };

      const Arguments = ({ action }) => {
        return (
          <div className="display-margin">
            <div className="blue">Arguments: </div>
            <CopyToClipboard content={action.arguments} />
            <span className="selector">{action.arguments}</span>
          </div>
        );
      };

      const Errors = ({ action }) => {
        if (action.errors.length !== 0) {
          return (
            <div className="display-margin">
              <div className="blue">Errors ({action.errors.length})</div>
              {action.errors.map((error, idx) => (
                <div key={idx}>
                  <CopyToClipboard content={error} />
                  <span className="statusFail selector">{error}</span>
                </div>
              ))}
            </div>
          );
        }
        return null;
      };

      const Artifacts = ({ action }) => {
        if (
          action.hasOwnProperty("artifacts") &&
          action.artifacts.length !== 0
        ) {
          return (
            <div className="display-margin">
              <span className="blue">
                Artifacts ({action.artifacts.length})
              </span>
              <div className="artifact-div">
                {action.artifacts.map((artifact) => (
                  <div key={artifact}>
                    <i className="fas fa-paperclip" />
                    <a href={artifact} target="_blank">
                      {artifact}
                    </a>
                  </div>
                ))}
              </div>
            </div>
          );
        }
        return null;
      };

      const Summary = ({ action }) => {
        return (
          <div className="display-margin summary-container  ">
            <div>
              Run <strong>{action.summary.testsCount}</strong> test(s).{" "}
            </div>
            <div className="summary-results-container">
              <div>
                Passed: <strong>{action.summary.successCount}</strong>
              </div>
              <div>
                Failed: <strong>{action.summary.failedCount}</strong>
              </div>
              <div>
                Inconclusive:{" "}
                <strong>{action.summary.inconclusiveCount}</strong>
              </div>
              <div>
                Ignored: <strong>{action.summary.ignoredCount}</strong>
              </div>
              <div>
                Skipped: <strong>{action.summary.skippedCount}</strong>
              </div>
              <div>
                Not runnable: <strong>{action.summary.notRunCount}</strong>
              </div>
            </div>
          </div>
        );
      };

      const OverallResult = ({ action }) => {
        if (action.type === "TestSession") {
          return (
            <div className="display-margin">
              <span className="blue">Overall results:</span>{" "}
              {action.summary.success ? (
                <span className="statusSuccess">SUCCESS</span>
              ) : (
                <span className="statusFail">FAIL</span>
              )}
            </div>
          );
        } else if (action.type === "TestStatus") {
          switch (action.state) {
            case 0:
              return (
                <div className="display-margin">
                  <span className="blue">Overall results:</span>{" "}
                  <StatusInconclusive status={"Inconclusive"} />
                </div>
              );
            case 1:
            case 2:
            case 3:
            case 7:
              return (
                <div className="display-margin">
                  <span className="blue">Overall results:</span>{" "}
                  <StatusIgnored status={"Ignored"} />
                </div>
              );
            case 4:
              return (
                <div className="display-margin">
                  <span className="blue">Overall results:</span>{" "}
                  <StatusSuccess status={"Success"} />
                </div>
              );
            case 5:
            case 6:
              return (
                <div className="display-margin">
                  <span className="blue">Overall results:</span>{" "}
                  <StatusFail status={"Failed"} />
                </div>
              );
            default:
              return null;
          }
        } else if (action.type === "TestSuite") {
          return (
            <div className="display-margin">
              <span className="blue">Overall results:</span>{" "}
              {action.errors.length === 0 ? (
                <span className="statusSuccess">SUCCESS</span>
              ) : (
                <span className="statusFail">FAIL</span>
              )}
            </div>
          );
        }
      };

      const Conclusion = ({ action }) => {
        if (action.type === "TestSession") {
          return (
            <div className="display-margin">
              <span className="blue">Conclusion:</span>{" "}
              {!action.summary.success ? (
                <span className="statusFail">
                  {action.summary.failureConclusion}
                </span>
              ) : (
                <span className="statusSuccess">SUCCESS</span>
              )}
            </div>
          );
        } else if (action.type === "TestSuite") {
          return (
            <div className="display-margin">
              <span className="blue">Conclusion:</span>{" "}
              {
                <span className="statusFail">
                  {action.summary.failureReasons[2]}
                </span>
              }
            </div>
          );
        } else {
          return null;
        }
      };

      const Suites = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Suites count:</span>{" "}
            <strong>{action.summary.suitesCount}</strong>
          </div>
        );
      };

      const Command = ({ action, prefix }) => {
        if (action.minimalCommandLine.length !== 0) {
          return (
            <div className="display-margin">
              <div className="blue">Command to run locally: </div>
              <CopyToClipboard
                content={prefix + action.minimalCommandLine.join(" ")}
              />
              <span className="selector">
                {prefix + action.minimalCommandLine.join(" ")}
              </span>
            </div>
          );
        }
        return null;
      };

      const Scope = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Scope:</span> <strong>{action.scope}</strong>
          </div>
        );
      };

      const Platform = ({ action }) => {
        if (action.platform !== null) {
          return (
            <div className="display-margin">
              <span className="blue">Platform:</span>{" "}
              <strong>{action.platform}</strong>
            </div>
          );
        }
        return null;
      };

      const CopyToClipboard = ({ content, onCopied }) => {
        const serializeBeforeCopy = (obj) => {
          if (typeof obj === "string") {
            return obj;
          }
          if (Array.isArray(obj)) {
            return obj.join(" ");
          }
          throw `Cannot copy ${obj} to the clipboard, it's neither a string nor an array`;
        };

        const handleTextClick = () => {
          navigator.clipboard.writeText(serializeBeforeCopy(content));
          if (onCopied) onCopied(content);
        };

        return (
          <div className="copy-btn-container">
            <button
              className="btn-copy"
              name="btn-copy"
              onClick={handleTextClick}
            >
              Copy{" "}
              <i className="fas fa-clipboard-check" style={{ size: 10 }}></i>
            </button>
          </div>
        );
      };

      const Message = ({ action }) => {
        if (action.message.length !== 0) {
          const message = action.message.split(/\r?\n/);
          return (
            <div className="display-margin">
              <div className="blue bottom-space">Message:</div>
              <span className="selector">
                {message.map((msg, idx) => (
                  <div key={idx}>{msg}</div>
                ))}
              </span>
            </div>
          );
        }
        return null;
      };

      const StackTrace = ({ action }) => {
        if (
          action.hasOwnProperty("stackTrace2") &&
          action.stackTrace2.length !== 0
        ) {
          return (
            <div className="display-margin">
              <div className="blue bottom-space">Stack-trace:</div>

              {action.stackTrace2.map((item, idx) => {
                if (item.hasOwnProperty("parsed") && item.parsed === false) {
                  return <div key={idx}>{item.rawFrameString}</div>;
                } else {
                  return (
                    <div key={idx}>
                      At {item.method} in{" "}
                      <a href={item.ref} target="_blank">
                        {item.file}:{item.line}
                      </a>
                    </div>
                  );
                }
              })}
            </div>
          );
        } else if (
          action.type === "LogEntry" &&
          action.stacktrace.length !== 0
        ) {
          return (
            <div className="display-margin">
              <div className="blue bottom-space">Stack-trace:</div>
              <div className="selector">{action.stacktrace}</div>
            </div>
          );
        } else if (action.stackTrace.length !== 0) {
          return (
            <div className="display-margin">
              <div className="blue bottom-space">Stack-trace:</div>
              <div className="selector">{action.stackTrace}</div>
            </div>
          );
        }
        return null;
      };

      const Severity = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Severity: </span>
            <span>{action.severity}</span>
          </div>
        );
      };

      const Line = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Line:</span>
            <span>{action.line}</span>
          </div>
        );
      };

      const File = ({ action }) => {
        return (
          <div className="display-margin">
            <div className="blue">File:</div>
            <div className="selector">{action.file}</div>
          </div>
        );
      };

      const Phase = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Phase: </span>
            <span>{action.phase}</span>
          </div>
        );
      };

      const MemoryLabels = ({ action }) => {
        return (
          <div className="display-margin">
            <div className="blue">Memory labels: </div>
            {action.memoryLabels.map((label) =>
              Object.keys(label).map((key, i) => (
                <div key={i}>
                  <span>{key}</span> : <span>{label[key]}</span>
                </div>
              ))
            )}
          </div>
        );
      };

      const BuildUrl = ({ action }) => {
        if (action.buildUrl.length !== 0) {
          return (
            <div className="display-margin">
              <span className="blue">Build URL:</span>
              <a href={action.buildUrl} target="_blank">
                {action.buildUrl}
              </a>
            </div>
          );
        }
        return null;
      };

      const Type = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Type: </span>
            <span>{action.type} </span>
          </div>
        );
      };

      const Duration = ({ action }) => {
        return (
          <div className="display-margin">
            <span className="blue">Duration: </span>
            <span>{durationToTimeStr(action)} </span>
          </div>
        );
      };

      // Image Comparison tool
      const ImageComparison = ({ action }) => {
        if (action.artifacts.length > 0) {
          const images = action.artifacts;
          const [header, setHeader] = React.useState({
            index: 0,
            headersList: ["Rendered", "Expected", "Difference"],
          });
          const [image, setImage] = React.useState({
            index: 0,
            imageList: images,
          });

          const loadRenderedImage = () => {
            let newHeader = { ...header };
            newHeader.index = 0;
            setHeader(newHeader);

            let newImage = { ...image };
            newImage.index = 0;
            setImage(newImage);
          };

          const loadExpectedImage = () => {
            let newHeader = { ...header };
            newHeader.index = 1;
            setHeader(newHeader);

            let newImage = { ...image };
            newImage.index = 1;
            setImage(newImage);
          };

          const loadDiffImage = () => {
            let newHeader = { ...header };
            newHeader.index = 2;
            setHeader(newHeader);

            let newImage = { ...image };
            newImage.index = 2;
            setImage(newImage);
          };

          return (
            <div className="display-margin">
              <div className="blue">Images Comparison:</div>
              <ImageContainer>
                <ImageHeader headerText={header.headersList[header.index]} />
                <ImageDisplay image={image.imageList[image.index]} />
                <Buttons>
                  <Button
                    onMouseDown={loadExpectedImage}
                    onMouseUp={loadRenderedImage}
                  >
                    Expected
                  </Button>
                  <Button
                    onMouseDown={loadDiffImage}
                    onMouseUp={loadRenderedImage}
                  >
                    Difference
                  </Button>
                </Buttons>
              </ImageContainer>
            </div>
          );
        }

        return null;
      };

      const ImageContainer = ({ children }) => {
        return <div className="comparison-container">{children}</div>;
      };

      const ImageHeader = ({ headerText }) => {
        return <h4 className="header">{headerText}</h4>;
      };

      const ImageDisplay = ({ image }) => {
        return (
          <div className="image">
            <div className="imagePath">Path: {image}</div>
            <img src={image} />
          </div>
        );
      };

      const Buttons = ({ children, onMouseDown }) => {
        return <div className="buttons">{children}</div>;
      };

      const Button = ({ onMouseDown, onMouseUp, children }) => (
        <button className="btn" onMouseDown={onMouseDown} onMouseUp={onMouseUp}>
          {children}
        </button>
      );

      //Resizable SplitPane component

      const splitPaneContext = React.createContext();

      const SplitPane = ({ children, ...props }) => {
        const [leftWidth, setLeftWidth] = React.useState(null);

        const separatorXPosition = React.useRef(null);
        const splitPaneRef = React.createRef();

        const onMouseDown = (e) => {
          e.preventDefault();
          separatorXPosition.current = e.clientX;
        };

        const onMouseMove = (e) => {
          e.preventDefault();
          if (!separatorXPosition.current) {
            return;
          }

          const newLeftWidth =
            leftWidth + e.clientX - separatorXPosition.current;
          separatorXPosition.current = e.clientX;
          setLeftWidth(newLeftWidth);
        };

        const onMouseUp = () => {
          separatorXPosition.current = null;
        };

        React.useEffect(() => {
          document.addEventListener("mousemove", onMouseMove);
          document.addEventListener("mouseup", onMouseUp);

          return () => {
            document.removeEventListener("mousemove", onMouseMove);
            document.removeEventListener("mouseup", onMouseUp);
          };
        });

        return (
          <div {...props} className="split-pane" ref={splitPaneRef}>
            <splitPaneContext.Provider value={{ leftWidth, setLeftWidth }}>
              {children[0]}
              <div className="separator" onMouseDown={onMouseDown} />
              {children[1]}
            </splitPaneContext.Provider>
          </div>
        );
      };

      SplitPane.Left = function SplitPaneLeft(props) {
        const leftRef = React.createRef();
        const { leftWidth, setLeftWidth } = React.useContext(splitPaneContext);
        React.useEffect(() => {
          if (!leftWidth) {
            setLeftWidth(leftRef.current.clientWidth);
            leftRef.current.style.flex = "none";
            return;
          }
          leftRef.current.style.width = `${leftWidth}px`;
        }, [leftWidth]);

        return <div {...props} className="split-pane-left" ref={leftRef} />;
      };

      SplitPane.Right = function SplitPaneRight(props) {
        return <div {...props} className="split-pane-right" />;
      };

      ReactDOM.render(<App></App>, document.getElementById("root"));
    </script>
  </body>
</html>
